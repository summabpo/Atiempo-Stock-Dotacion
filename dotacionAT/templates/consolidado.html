{% extends 'layouts/base.html' %}
{% load static %}
{% load humanize %}

{% block content %}

<style>
#consolidado_table th {
    color: white;
    text-align: center;
}

#consolidado_table td {
    vertical-align: middle;
}

.dataTables_wrapper .dataTables_paginate .paginate_button {
    padding: 0.2rem 0.6rem;
    margin-left: 2px;
}
</style>


<h2>Consolidado - Periodo {{ periodo }}</h2>

<table id="consolidado_table" class="table table-striped table-hover table-bordered dt-responsive nowrap text-center" style="width:100%">
    <thead class="thead-dark">
        <tr>
            <th>Cliente</th>
            <th>Periodo</th>
            <th>Tipo Entrega</th>
            <th>Centro Costo</th>
            <th>Ciudad</th>
            <th>Total Entregas</th>
            <th>AcciÃ³n</th>
        </tr>
    </thead>
    <tbody>
        {% for item in consolidado %}
        <tr>
            <td>{{ item.empleado__cliente__nombre  }}</td>
            <td>{{ item.periodo }}</td>
            <td>{{ item.tipo_entrega }}</td>
            <td>{{ item.empleado__ciudad__nombre }}</td>
            <td>{{ item.empleado__centro_costo }}</td>
            <td>{{ item.total_entregas }}</td>
         <td>
        <!-- USA EL NOMBRE CORRECTO DEL CAMPO -->
        <a href="{% url 'generar_pdf_por_periodo' %}?periodo={{ item.periodo }}&cliente_id={{ item.empleado__cliente__id_cliente }}&tipo_entrega={{ item.tipo_entrega }}&ciudad_id={{ item.empleado__ciudad__id_ciudad }}&centro_costo={{ item.empleado__centro_costo }}"
        class="btn btn-primary btn-sm">
            ðŸ“„ Generar Lote PDF
        </a>
        
        <a href="{% url 'historial_entregas' %}?periodo={{ item.periodo }}&cliente_id={{ item.empleado__cliente__id_cliente }}&tipo_entrega={{ item.tipo_entrega }}&ciudad_id={{ item.empleado__ciudad__id_ciudad }}&centro_costo={{ item.empleado__centro_costo }}"
        class="btn btn-info btn-sm">
            ðŸ“‹ Ver Detalles
        </a>
    </td>
            <!-- <td>
              <a href="{% url 'generar_formato_entrega_pdf' %}?periodo={{ item.periodo }}&cliente={{ item.empleado__cliente|urlencode }}"
       class="btn btn-primary btn-sm">
        ðŸ“„ Descargar PDF
    </a>
    <a href="{% url 'historial_entregas' %}?periodo={{ item.periodo }}&cliente={{ item.empleado__cliente|urlencode }}"
       class="btn btn-info btn-sm">
        ðŸ“‹ Detalle Entrega
    </a>
 <button class="btn btn-primary">
         <a href="{% url 'historial_entregas2' %}">
    Detalle Entrega 2
</a></button> 
            </td> -->
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">No hay entregas registradas.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
{% block extra_js %}

<script>
$(document).ready(function() {
    $('#consolidado_table').DataTable({
        responsive: true,
        paging: true,
        searching: true,
        ordering: true,
        order: [[1, "desc"]],
        language: {
            search: "Buscar:",
            lengthMenu: "Mostrar _MENU_ registros por pÃ¡gina",
            zeroRecords: "No se encontraron resultados",
            info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
            infoEmpty: "No hay registros disponibles",
            infoFiltered: "(filtrado de _MAX_ registros totales)",
            paginate: {
                first: "Primero",
                last: "Ãšltimo",
                next: "Siguiente",
                previous: "Anterior"
            }
        }
    });
});
</script>

{% endblock %}