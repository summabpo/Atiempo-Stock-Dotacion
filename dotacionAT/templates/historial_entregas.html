
{% extends 'layouts/base.html' %}
{% load humanize %}

{% block content %}
<div class="card shadow">
  <div class="card-header bg-primary text-white">
    <h4 class="mb-0">
      ðŸ“‹ Historial de Entregas de DotaciÃ³n
      {% if cliente and periodo %}
        - {{ cliente }} ({{ periodo }})
      {% elif cliente %}
        - {{ cliente }}
      {% elif periodo %}
        - {{ periodo }}
      {% endif %}
    </h4>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table id="historial_table" class="table table-striped table-hover text-center">
        <thead class="thead-dark">
          <tr>
            <th>Empleado</th>
            <th>CÃ©dula</th>
            <th>Ciudad</th>
            <th>Cargo</th>
            <th>Cliente</th>
            <th>Sexo</th>
            <th>Fecha Generado</th>
            <th>ðŸ§¥ Prendas Entregadas</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for entrega in entregas %}
          <tr>
              <td>{{ entrega.empleado.nombre }}</td>
              <td>{{ entrega.empleado.cedula }}</td>
              <td>{{ entrega.empleado.ciudad }}</td>
              <td>{{ entrega.empleado.cargo }}</td>
              <td>{{ entrega.empleado.cliente }}</td>
              <td>{{ entrega.empleado.sexo }}</td>
              <td>{{ entrega.fecha_entrega|date:"Y-m-d H:i" }}</td>
              <td>
                <div class="d-flex flex-wrap gap-2">
                  {% for detalle in entrega.detalles.all %}
                    <span 
                      class="badge badge-pill badge-info" 
                      data-toggle="tooltip" 
                      title="{{ detalle.producto.descripcion|default:detalle.producto.nombre }}">
                      ðŸ‘• {{ detalle.producto.nombre }} x{{ detalle.cantidad }}
                    </span>
                  {% empty %}
                    <span class="text-muted">Sin prendas</span>
                  {% endfor %}
                </div>
              </td>
              <td>
         <button  class="button-primary"><a href="{% url 'generar_pdf_por_entrega' entrega.id %}" class="btn btn-sm btn-danger">
        <i class="fa fa-file-pdf"></i> PDF
    </a></button>
    </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>


{% block extra_js %}
<script>
 $(document).ready(function () {
    if (!$.fn.DataTable.isDataTable('#historialTable')) {
        $('#historialTable').DataTable();
    }
});
if (!$.fn.DataTable.isDataTable('#historialTable')) {
    $('#historialTable').DataTable();
} 
$(document).ready(function() {
    $('#historial_table').DataTable({
        responsive: true,
        paging: true,
        searching: true,
        ordering: true,
        order: [[1, "desc"]],
        language: {
            search: "Buscar:",
            lengthMenu: "Mostrar _MENU_ registros por pÃ¡gina",
            zeroRecords: "No se encontraron resultados",
            info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
            infoEmpty: "No hay registros disponibles",
            infoFiltered: "(filtrado de _MAX_ registros totales)",
            paginate: {
                first: "Primero",
                last: "Ãšltimo",
                next: "Siguiente",
                previous: "Anterior"
            }
        }
    });
});
</script>
{% endblock %}

{% endblock %}